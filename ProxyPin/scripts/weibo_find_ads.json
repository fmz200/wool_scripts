{"enabled":true,"name":"å¾®åšå‘ç°é¡µå»å¹¿å‘Š","url":"^https?://api.weibo.cn/2/search/(finder|container_timeline|container_discover)","script":"/**\n * author:fmz200\n * date:2023-11-19 10:13:00\n */\n\n// åœ¨è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ä¹‹å‰,è°ƒç”¨æ­¤å‡½æ•°,æ‚¨å¯ä»¥åœ¨æ­¤å¤„ä¿®æ”¹è¯·æ±‚æ•°æ®\nasync function onRequest(context, request) {\n  console.log(\"è¯·æ±‚URL=\" + request.url);\n  //URLå‚æ•°\n  request.queries[\"reqParams\"] = \"value\";\n  //æ›´æ–°æˆ–æ·»åŠ æ–°æ ‡å¤´\n  request.headers[\"X-New-Headers\"] = \"My-Value\";\n  delete request.headers[\"Key-Need-Delete\"];\n\n  //Update Body ä½¿ç”¨fetch APIè¯·æ±‚æ¥å£ï¼Œå…·ä½“æ–‡æ¡£å¯ç½‘ä¸Šæœç´¢fetch API\n  //request.body = await fetch('https://www.baidu.com/').then(response => response.text());\n\n  //å…±äº«å‚æ•° åé¢onResponseæ—¶å–å‡º\n  context[\"request_url\"] = request.url;\n  return request;\n}\n\nconst url1 = '/search/finder';\nconst url2 = '/search/container_timeline'; // å‘ç°é¡µé¢\nconst url3 = '/search/container_discover';\nconst url4 = '/api.weibo.cn/2/page'; // å¾®åšçƒ­æœé¡µé¢url\nconst url5 = '/statuses/container_timeline_topicpage'; // å¾®åšè¶…è¯é¡µé¢\nconst url6 = '/statuses/extend'; // å¾®åšè¯¦æƒ…é¡µé¢å¹¿å‘Š\nconst url7 = '/groups/allgroups/v2' // å¾®åšé¦–é¡µTabæ ‡ç­¾é¡µ\n\nconst weiboPic = [\n  \"https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/apps/Weibo-01.png\",\n  \"https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/apps/Weibo-27.png\",\n  \"https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/apps/Weibo-30.png\",\n  \"https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/apps/Weibo-32.png\"\n];\nconst titleSubPicMap = {\n  'ç”µå½±': 'https://simg.s.weibo.com/imgtool/20221207_dianying.png',\n  'çƒ­è®®': 'https://simg.s.weibo.com/20220402_hottopic-icon.png',\n  'å½±åƒå¹´': 'https://simg.s.weibo.com/ads/1%2Fads_1692185628.png',\n  'æœ¬åœ°': 'https://simg.s.weibo.com/20190123154142_tongcheng.png',\n  'äºšè¿ç”µç«': 'https://simg.s.weibo.com/ads/1%2Fads_1694765662.png',\n  'ç›´æ’­': 'https://simg.s.weibo.com/20210705_live0705.png',\n  'è´¢ç»': 'https://simg.s.weibo.com/20190124150415_caijing.png',\n  'æ‰¾äºº': 'https://simg.s.weibo.com/20190125144608_zhaoren.png',\n  'æ—¶å°š': 'https://simg.s.weibo.com/imgtool/20220928_fashion.png',\n  'é•¿æ–‡': 'https://simg.s.weibo.com/20220621_%E9%95%BF%E6%96%87%E5%8F%91%E7%8E%B0%E9%A1%B5icon%403x.png',\n  'èµ›äº‹': 'https://simg.s.weibo.com/20201030_%E8%B5%9B%E4%BA%8B.png',\n  'æ•™è‚²': 'https://simg.s.weibo.com/20200303_edu0303.png',\n  'éŸ³ä¹': 'https://simg.s.weibo.com/imgtool/20221207_yinyue.png',\n  'æˆ¿äº§': 'https://simg.s.weibo.com/20190129182003_house.png',\n  'å°æ¸¸æˆ': 'https://simg.s.weibo.com/20190118185226_youxi.png',\n  'ç¾é£Ÿ': 'https://simg.s.weibo.com/imgtool/20221207_food.png',\n  'çƒ­èŠ': 'https://simg.s.weibo.com/20220402_reliao.png',\n  'æ–°çŸ¥': 'https://simg.s.weibo.com/20211105_xinzhi.png',\n  'å¾®å…¬ç›Š': 'https://simg.s.weibo.com/ads/1%2Fads_1689323535.png',\n  'å¤§å¥åº·': 'https://simg.s.weibo.com/imgtool/20221116_health.png',\n  'æ´»åŠ¨': 'https://simg.s.weibo.com/20200915_huodong.png',\n  'æ¯å©´': 'https://simg.s.weibo.com/20210222_mombaby.png',\n  'ç å®ç‰çŸ³': 'https://simg.s.weibo.com/20210317_yushi.png',\n  'æ¸¸æˆä¸­å¿ƒ': 'https://simg.s.weibo.com/ads/1%2Fads_1687759038.png'\n};\nlet index = 1;\n\n// åœ¨å°†å“åº”æ•°æ®å‘é€åˆ°å®¢æˆ·ç«¯ä¹‹å‰,è°ƒç”¨æ­¤å‡½æ•°,æ‚¨å¯ä»¥åœ¨æ­¤å¤„ä¿®æ”¹å“åº”æ•°æ®\nasync function onResponse(context, request, response) {\n  // æ›´æ–°æˆ–æ·»åŠ æ–°æ ‡å¤´\n  // response.headers[\"Name\"] = context[\"name\"];\n\n  // Update status Code\n  // response.statusCode = 500;\n\n  let url = context[\"request_url\"];\n  let body = response.body;\n  console.log(\"å“åº”URL=\" + url);\n  try {\n    body = modifyMain(url, body);\n  } catch (e) {\n    console.log('è„šæœ¬è¿è¡Œå‡ºç°é”™è¯¯ï¼Œéƒ¨åˆ†å¹¿å‘Šæœªå»é™¤âš ï¸');\n    console.log('é”™è¯¯ä¿¡æ¯ï¼š' + e.message);\n  }\n\n  response.body = JSON.stringify(body);\n  return response;\n}\n\nfunction modifyMain(url, data) {\n  let resp_data = JSON.parse(data);\n  // 1ã€é¦–æ¬¡ç‚¹å‡»å‘ç°æŒ‰é’®\n  if (url.includes(url1)) {\n    const payload = resp_data.channelInfo?.channels?.[0]?.payload;\n    console.log('è¿›å…¥å‘ç°é¡µ...');\n    if (payload.items[1].data.itemid === \"hot_search_push\") {\n      index = 2;\n    }\n\n    // 1.1ã€ä¸‹æ ‡æ˜¯1çš„ä¸ºçƒ­æœæ¨¡å—\n    payload.items[index].data.group = removeHotSearchAds(payload.items[index].data.group);\n\n    // 1.2ã€ä¸‹æ ‡ä¸º2çš„æ˜¯è½®æ’­å›¾æ¨¡å—\n    console.log('ç§»é™¤è½®æ’­æ¨¡å—ğŸ’•ğŸ’•');\n    payload.items[index + 1] = {};\n\n    // 1.3ã€ä¸‹æ ‡ä¸º3çš„æ˜¯çƒ­è®®æ¨¡å—\n    console.log('ç§»é™¤finder_channelæ¨¡å—ğŸ’•ğŸ’•');\n    if (payload.items[index + 2].data?.more_pic?.includes('ads')) {\n      delete payload.items[index + 2].data.more_pic;\n    }\n    payload.items[index + 2].data.group = removeFinderChannelAds(payload.items[index + 2].data.group);\n\n    // 1.4ã€items[i].category = \"feed\" æ˜¯çƒ­é—¨å¾®åšçš„éƒ¨åˆ†\n    payload.items = removeCategoryFeedAds(payload.items);\n\n    // 1.5ã€èƒŒæ™¯å›¾å¹¿å‘Š\n    if (payload.loadedInfo?.headerBack) {\n      delete payload.loadedInfo.headerBack;\n    }\n\n    return JSON.stringify(resp_data);\n  }\n\n  // 2ã€å‘ç°é¡µé¢åˆ·æ–°/å†æ¬¡ç‚¹å‡»å‘ç°æŒ‰é’®\n  if (url.includes(url2) || url.includes(url3)) {\n    console.log('åˆ·æ–°å‘ç°é¡µ...');\n    if (resp_data.items[1].data.itemid === \"hot_search_push\") {\n      index = 2;\n    }\n\n    // 2.1ã€ä¸‹æ ‡æ˜¯1çš„ä¸ºçƒ­æœæ¨¡å—\n    resp_data.items[index].data.group = removeHotSearchAds(resp_data.items[index].data.group);\n\n    // 2.2ã€ä¸‹æ ‡ä¸º2çš„æ˜¯è½®æ’­å›¾æ¨¡å—\n    console.log('ç§»é™¤è½®æ’­å›¾æ¨¡å—ğŸ¤£ğŸ¤£');\n    resp_data.items[index + 1] = {};\n\n    // 2.3ã€ä¸‹æ ‡ä¸º3çš„æ˜¯çƒ­è®®æ¨¡å—\n    console.log('ç§»é™¤finder_channelæ¨¡å—ğŸ’•ğŸ’•');\n    if (resp_data.items[index + 2].data?.more_pic?.includes('ads')) {\n      delete resp_data.items[index + 2].data.more_pic;\n    }\n    resp_data.items[index + 2].data.group = removeFinderChannelAds(resp_data.items[index + 2].data.group);\n\n    // 2.4ã€items[i].category = \"feed\" æ˜¯çƒ­é—¨å¾®åšçš„éƒ¨åˆ†\n    resp_data.items = removeCategoryFeedAds(resp_data.items);\n\n    // 2.5ã€èƒŒæ™¯å›¾å¹¿å‘Š\n    if (resp_data.loadedInfo?.headerBack) {\n      delete resp_data.loadedInfo.headerBack;\n    }\n    return JSON.stringify(resp_data);\n  }\n\n  // 3ã€å¾®åšçƒ­æœé¡µé¢åˆ·æ–°\n  if (url.includes(url4) && resp_data.cards && resp_data.cards[0].card_group) {\n    console.log('å¾®åšçƒ­æœé¡µé¢å¹¿å‘Šå¼€å§‹ğŸ’•');\n    resp_data.cards[0].card_group = resp_data.cards[0].card_group.filter(group => group.promotion == null);\n    console.log('å¾®åšçƒ­æœé¡µé¢å¹¿å‘Šç»“æŸğŸ’•ğŸ’•');\n    return JSON.stringify(resp_data);\n  }\n\n  // 4ã€å¾®åšè¶…è¯é¡µé¢\n  if (url.includes(url5) && resp_data.items) {\n    console.log('å¾®åšè¶…è¯é¡µé¢å¹¿å‘Šå¼€å§‹ğŸ’•');\n    resp_data.items = resp_data.items.filter(item => !item.data || item.data.mblogtypename !== \"å¹¿å‘Š\");\n    console.log('å¾®åšè¶…è¯é¡µé¢å¹¿å‘Šç»“æŸğŸ’•ğŸ’•');\n    return JSON.stringify(resp_data);\n  }\n\n  // 5ã€å¾®åšè¶…è¯é¡µé¢\n  if (url.includes(url6)) {\n    console.log('å¾®åšè¯¦æƒ…é¡µé¢å¹¿å‘Šå¼€å§‹ğŸ’•');\n    resp_data.head_cards = [];\n    console.log('å¾®åšè¯¦æƒ…é¡µé¢å¹¿å‘Šç»“æŸğŸ’•ğŸ’•');\n    return JSON.stringify(resp_data);\n  }\n\n  // 6ã€ç§»é™¤å¾®åšé¦–é¡µçš„å¤šä½™tabé¡µ\n  if (url.includes(url7)) {\n    resp_data.pageDatas = removePageDataAds(resp_data.pageDatas);\n    swapObjectsInArray(resp_data.pageDatas[0].categories[0].pageDatas, 0, 1);\n    return JSON.stringify(resp_data);\n  }\n\n  console.log('æ²¡æœ‰å¹¿å‘Šæ•°æ®ğŸ§§ğŸ§§');\n  return data;\n}\n\n// ç§»é™¤â€œå¾®åšçƒ­æœâ€çš„å¹¿å‘Š\nfunction removeHotSearchAds(groups) {\n  if (!groups) return;\n  console.log('ç§»é™¤å‘ç°é¡µçƒ­æœå¹¿å‘Šå¼€å§‹ğŸ’•');\n  const newGroups = groups.filter(group => !(group.itemid?.includes(\"is_ad_pos\") || group.promotion));\n  console.log('ç§»é™¤å‘ç°é¡µçƒ­æœå¹¿å‘Šç»“æŸğŸ’•ğŸ’•');\n  return newGroups;\n}\n\n// ç§»é™¤â€œå¾®åšçƒ­æœâ€ä¸‹é¢çš„â€œçƒ­èŠï¼Œæœ¬åœ°ç­‰â€çš„å¹¿å‘Š\nfunction removeFinderChannelAds(groups) {\n  if (!groups) return;\n  console.log('ç§»é™¤å‘ç°é¡µfinder_channelå¹¿å‘Šå¼€å§‹ğŸ’•');\n  const newGroups = [];\n  for (const group of groups) {\n    if (group.pic?.includes('ads')) {\n      group.pic = titleSubPicMap[group.title_sub] || \"https://simg.s.weibo.com/20200915_huodong.png\";\n    }\n    newGroups.push(group);\n  }\n  console.log('ç§»é™¤å‘ç°é¡µfinder_channelå¹¿å‘Šç»“æŸğŸ’•ğŸ’•');\n  return newGroups;\n}\n\n// ç§»é™¤â€œçƒ­æœå¾®åšâ€ä¿¡æ¯æµçš„å¹¿å‘Š\nfunction removeCategoryFeedAds(items) {\n  console.log('ç§»é™¤å‘ç°é¡µçƒ­é—¨å¾®åšå¹¿å‘Šå¼€å§‹ğŸ’•');\n  const newItems = items.filter(item => item.category !== \"feed\" || (item.data && item.data.mblogtypename !== \"å¹¿å‘Š\"));\n  console.log('ç§»é™¤å‘ç°é¡µçƒ­é—¨å¾®åšå¹¿å‘Šç»“æŸğŸ’•ğŸ’•');\n  return newItems;\n}\n\n// ç§»é™¤å¾®åšé¦–é¡µçš„å¤šä½™tabé¡µ\nfunction removePageDataAds(items) {\n  console.log('ç§»é™¤å¾®åšé¦–é¡µçš„å¤šä½™tabé¡µå¼€å§‹ğŸ’•');\n  const newItems = items.filter(item => item.pageDataType !== \"homeExtend\");\n  console.log('ç§»é™¤å¾®åšé¦–é¡µçš„å¤šä½™tabé¡µç»“æŸğŸ’•ğŸ’•');\n  return newItems;\n}\n\n// äº¤æ¢é›†åˆä¸­ä¸¤ä¸ªå¯¹è±¡çš„ä½ç½®\nfunction swapObjectsInArray(array, index1, index2) {\n  console.log('äº¤æ¢tabé¡µé¡ºåºå¼€å§‹ğŸ’•');\n  const temp = array[index1];\n  array[index1] = array[index2];\n  array[index2] = temp;\n\n  array[index2].type = array[index1].type;\n  array[index2].apipath = \"statuses/container_timeline_unread\";\n  delete array[index2].navigation_title;\n  console.log('äº¤æ¢tabé¡µé¡ºåºç»“æŸğŸ’•ğŸ’•');\n}"}
