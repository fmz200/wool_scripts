# æ€ä¹ˆæ·»åŠ å’Œä½¿ç”¨é‡å†™ï¼šHow to add and use rewrite

> ğŸ“£ è¯´æ˜ï¼šè¿™éƒ¨åˆ†æ–‡æ¡£åªè®¨è®ºæ€ä¹ˆæ·»åŠ å’Œä½¿ç”¨é‡å†™ï¼Œä»¥åŠä¸»è¦æœ‰å‡ ç§æ–¹å¼æ·»åŠ é‡å†™

## 1ï¸âƒ£ ä»€ä¹ˆæ˜¯é‡å†™ï¼Ÿ
> **rewrite**ï¼šåˆåâ€œä¿®è®¢ï¼Œä¿®æ”¹â€ï¼Œä»ç¼–ç¨‹ [egï¼šJava] çš„è§’åº¦æ¥è¯´ï¼Œé‡å†™çš„æ„æ€æ˜¯ï¼šé‡å†™æ˜¯å­ç±»å¯¹çˆ¶ç±»çš„å…è®¸è®¿é—®çš„æ–¹æ³•çš„å®ç°è¿‡ç¨‹è¿›è¡Œé‡æ–°ç¼–å†™, è¿”å›å€¼å’Œå½¢å‚éƒ½ä¸èƒ½æ”¹å˜ã€‚å³`å¤–å£³ä¿æŒä¸å˜ï¼Œæ ¸å¿ƒå†…å®¹é‡å†™ï¼`
> ç®€å•æ¥è¯´å°±æ˜¯å¯¹æˆ‘ä»¬`å‘å‡ºçš„è¯·æ±‚`å’Œ`æ¥æ”¶åˆ°çš„æ•°æ®`åœ¨ä¸ä¿®æ”¹æ•°æ®ç»“æ„çš„æƒ…å†µä¸‹ï¼Œä¿®æ”¹å…¶å…·ä½“æ•°æ®ä»¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ã€‚
> 
> â¡ï¸ ä¸¾ä¸ªæ —å­ï¼š
> 
> å‡å¦‚æˆ‘ä»¬æ”¶åˆ°ä¸€ç»„æ•°æ®ï¼š
>> ```json
>> {"basic":{"token":123},"info":[{"ad":"example.jpg"}],"result":0}
>>```
> æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸ºï¼š
>> ```json
>> {"basic":{"token":123},"info":[],"result":1}
>>```
> å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æŠŠ **info** ä¸­çš„å†…å®¹åˆ é™¤äº†ï¼ŒåŒæ—¶ä¿®æ”¹äº† **result** çš„å€¼ï¼Œä½†æ˜¯ **info** çš„æ•°æ®ç±»å‹æ²¡æœ‰å˜(è¿˜æ˜¯List)ï¼Œæ•´ä½“çš„æ•°æ®ç»“æ„ä¹Ÿæ²¡æœ‰å˜ï¼Œåªæ˜¯å¯¹å…·ä½“çš„æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ã€‚
> 
> â¶ ä¸ºä»€ä¹ˆä¸èƒ½ä¿®æ”¹æ•°æ®ç»“æ„ï¼ŸåŸå› æ˜¯æ•°æ®éƒ½æ˜¯ä»æœåŠ¡å™¨è¿”å›åˆ°APPæˆ–è€…APPå‘é€åˆ°æœåŠ¡å™¨çš„ï¼Œä¸¤è€…æ•°æ®çš„å°è£…æœ‰çº¦å®šçš„è§„åˆ™ï¼Œå¦‚æœä¸€æ–¹ä¿®æ”¹äº†æ•°æ®ç»“æ„ï¼Œé‚£å¦ä¸€æ–¹å°±æ— æ³•è§£æå¯¼è‡´æŠ¥é”™ã€‚å°±æ¯”å¦‚ç”µè§†å‰§é‡Œæ¥å¤´çš„åŒæ–¹éƒ½æœ‰å¯¹åº”çš„æš—å·ï¼Œä»»ä½•ä¸€æ–¹è¯´é”™éƒ½ä¼šå¯¹ä¸ä¸Šå·ã€‚
> 
> â· æ•°æ®çš„ä¿®æ”¹ä¸»è¦æ˜¯`ä¿®æ”¹æ•°å€¼`å’Œ`åˆ é™¤éƒ¨åˆ†æ•°æ®`ï¼Œæ¯”å¦‚ä¸Šæ–¹çš„æ•°æ®ä¸­ `result = 0` è¡¨ç¤ºâ€œä¸æ˜¯ä¼šå‘˜â€ï¼Œé‚£æˆ‘ä»¬ä¿®æ”¹æˆ 1 æˆä¸ºä¼šå‘˜ï¼›info é‡Œå­˜æ”¾çš„æ˜¯å¹¿å‘Šæ•°æ®ï¼Œé‚£æˆ‘ä»¬æŠŠä»–åˆ é™¤ï¼Œappå°±ä¸ä¼šåˆ™å±•ç¤ºå¹¿å‘Šã€‚
> ä¸ºä»€ä¹ˆä¸èƒ½æ–°å¢å­—æ®µæ•°æ®å‘¢ï¼ŸåŒ â¶ ä¸­æ‰€è¯´ï¼ŒåŒæ–¹æ˜¯æœ‰çº¦å®šçš„ï¼Œå¤šå‡ºçš„æ•°æ®å¯¹æ–¹æ˜¯ä¸è®¤è¯†çš„ã€‚
> ä¾‹å¦‚ä¸Šæ–¹çš„æ•°æ®æˆ‘ä»¬å¢åŠ ä¸€ä¸ªå­—æ®µæ•°æ®æˆ `{"basic":{"token":123},"info":[],"result":1, "data":9}` ï¼Œ`"data":9` å¯¹æ–¹æ˜¯ä¸è®¤çš„ã€‚


## 2ï¸âƒ£ é‡å†™æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ
> åŒ 1ï¸âƒ£ ä¸­æ‰€è¯´ï¼Œæ—¢ç„¶å¯ä»¥ä¿®æ”¹æ•°æ®ï¼Œé‚£éƒ¨åˆ†è½¯ä»¶/ç½‘ç«™çš„ä¼šå‘˜ä»¥åŠå¹¿å‘Šå°±æœ‰äº†è§£é”çš„æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œé‡å†™çš„ä½œç”¨ä¸»è¦æ˜¯ï¼šè§£é”è½¯ä»¶ä¼šå‘˜ä»¥åŠå»é™¤çƒ¦äººçš„å¹¿å‘Šï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„ã€‚ãŠ—ï¸ æ³¨ï¼šè¿™åªæ˜¯å…¶ä¸­çš„éƒ¨åˆ†åŠŸèƒ½ã€‚
> 
> â¶ ä¸ºä»€ä¹ˆæ˜¯éƒ¨åˆ†è½¯ä»¶å’Œç½‘ç«™ï¼Ÿå› ä¸ºä¿®æ”¹æ•°æ®éœ€è¦ä¸€ä¸ªå¿…è¦çš„æ¡ä»¶ï¼šåŸŸåå¿…é¡»å¯ä»¥è¿›è¡ŒMITM(ä¸­é—´äººæ”»å‡»)ï¼Œåªæœ‰å¯ä»¥MITMæ‰èƒ½è·å–åˆ°appä¸æœåŠ¡å™¨ä¼ è¾“çš„æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚ä¾‹å¦‚æŠ–éŸ³ç³»åˆ—çš„åŸŸåéƒ½æ˜¯æ— æ³•MITMçš„ï¼Œä½ ä¼šå‘ç°æ— æ³•æŠ“åŒ…ã€‚

## 3ï¸âƒ£ æ€ä¹ˆæ·»åŠ é‡å†™ï¼Ÿæœ‰å“ªäº›æ–¹å¼ï¼Ÿ
> æ‰“å¼€quanXçš„è®¾ç½®é¡µé¢æˆ–è€…é…ç½®æ–‡ä»¶ä½ èƒ½çœ‹åˆ°é‡å†™ä¸»è¦æœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥é…ç½®ï¼š `[rewrite_remote]` ä»¥åŠ `[rewrite_local]`ã€‚

> â¶ ä»–ä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ
>> â’ˆ è¿œç¨‹å¤å†™`[rewrite_remote]`ï¼šé…ç½®éƒ½æ˜¯åˆ«äººå†™å¥½çš„ï¼ŒåŒ…å«ä¸»æœºå hostname ä»¥åŠå¤å†™ rewrite è§„åˆ™ï¼Œæ‹¿æ¥å³ç”¨ï¼›æœ¬åœ°å¤å†™`[rewrite_local]`ï¼šåªæœ‰å¤å†™ rewrite è§„åˆ™ï¼Œhostname éœ€è¦è‡ªè¡Œåœ¨ `[hostname]` æ¨¡å—å†æ·»åŠ ï¼Œç›¸å½“äºæŠŠ`[rewrite_remote]`æ–‡ä»¶ä¸­çš„é…ç½®å¤åˆ¶å‡ºæ¥è‡ªè¡Œé…ç½®ã€‚
>>
>> â’‰ å¯¹äºåŒä¸€æ¡è§„åˆ™ï¼Œ`[rewrite_local]`ä¼˜å…ˆäº`[rewrite_remote]`ç”Ÿæ•ˆï¼Œæ„æ€å°±æ˜¯`[rewrite_remote]`çš„é…ç½®æ˜¯å¤šä½™çš„ä¸ä¼šç”Ÿæ•ˆã€‚
>>
>> â’Š å¯¹äºåŒä¸€æ¡è§„åˆ™ï¼Œä»»é€‰ä¸€ç§é…ç½®å³å¯ï¼Œæ¨è`[rewrite_remote]`ã€‚

> â© è¯ä¸å¤šè¯´ï¼Œä¸‹é¢ä»¥æœ¬åº“ä¸­å¤‡ä»½çš„å¢¨é±¼è„šæœ¬[æŸåº¦ç½‘ç›˜å€é€Ÿ](https://github.com/fmz200/wool_scripts/blob/main/QuantumultX/rewrite/Function/BaiduCloud.conf)ä¸ºä¾‹ï¼Œè®²è®²æ€ä¹ˆä¸€æ­¥ä¸€æ­¥åœ¨quanXä¸­é…ç½®ã€‚
> å…ˆæ¥çœ‹çœ‹è„šæœ¬å†…å®¹æœ‰ä»€ä¹ˆï¼š
> ```
> # > ç™¾åº¦äº‘
> https:\/\/pan\.baidu\.com\/rest\/2\.0\/membership\/user url script-response-body https://raw.githubusercontent.com/fmz200/wool_scripts/main/QuantumultX/scripts/Crack/bdcloud.js
> 
> hostname = pan.baidu.com
> ```
> é…ç½®ä¸­å»æ‰æ³¨é‡Šæœ‰ä¸¤è¡Œæœ‰æ•ˆå†…å®¹ï¼š
> ```
> https:\/\/pan\.baidu\.com\/rest\/2\.0\/membership\/user url script-response-body https://raw.githubusercontent.com/fmz200/wool_scripts/main/QuantumultX/scripts/Crack/bdcloud.js
> hostname = pan.baidu.com
> ```
> ç¬¬ 2 è¡Œï¼šhostnameè¡¨ç¤ºå¯¹å“ªä¸€ä¸ªåŸŸåè¿›è¡ŒMITM
> 
> ç¬¬ 1 è¡Œï¼šåŒ…å«å››éƒ¨åˆ†ï¼Œåˆ†åˆ«è¡¨ç¤ºï¼šæƒ³è¦MITMçš„è¯·æ±‚è·¯å¾„ï¼Œ urlç±»å‹ï¼Œ è„šæœ¬-å¯¹å“åº”-å“åº”ä½“çš„æ•°æ®ï¼Œ ç”¨äºMITMçš„è„šæœ¬è·¯å¾„
> 

### â‘   å…ˆè¯´ `[rewrite_remote]`

> ç¬¬ä¸€æ­¥ï¼šç‚¹æŒ‰é¦–é¡µå³ä¸‹è§’çš„å°é£è½¦ï¼Œå¾€ä¸‹æ»‘æ‰¾åˆ°`é‡å†™`æ¨¡å—ï¼›é€‰æ‹©`è§„åˆ™èµ„æº`ã€ä¸‹å›¾1ã€‘ï¼›
> 
> ç¬¬äºŒæ­¥ï¼šå¼•ç”¨èµ„æºé¡µé¢ï¼Œç‚¹å‡»å³ä¸Šè§’åŠ ğŸ‘Œå·â•è·³è½¬åˆ°å¡«å†™é¡µé¢ã€ä¸‹å›¾2ã€‘ï¼›
> 
> ç¬¬ä¸‰æ­¥ï¼šå¡«å†™`èµ„æºæ ‡ç­¾`å’Œ`èµ„æºè·¯å¾„`ï¼Œæ ‡ç­¾å¯ä»¥éšä¾¿å†™ï¼Œä½†æ˜¯è·¯å¾„å¿…é¡»å¡«å†™æ­£ç¡®ï¼Œå¡«å¥½ä»¥åç‚¹å‡»å³ä¸Šè§’å¯¹å·âœ…ä¿å­˜ã€ä¸‹å›¾3ã€‘ï¼›
> 
> ç¬¬å››æ­¥ï¼šä¿å­˜ä»¥åæ‰¾åˆ°åˆšæ·»åŠ çš„é‡å†™ï¼Œå³æ»‘é€‰æ‹©æ›´æ–°å›¾æ ‡ğŸ”„ã€ä¸‹å›¾4ã€‘ã€‚
>> è‹¥ä¸æç¤ºä»»ä½•é”™è¯¯å°±æ˜¯æ›´æ–°å®Œæ¯•ï¼Œè‹¥å‡ºç°404è¡¨ç¤ºèµ„æºä¸å­˜åœ¨ï¼Œç­‰å¾…ä½œè€…æ›´æ–°ï¼›è‹¥æç¤ºèµ„æºæ— æ³•è®¿é—®ã€ç½‘ç»œé”™è¯¯ç­‰å¯æ¢ä¸ªèŠ‚ç‚¹åœ¨å°è¯•æ›´æ–°ã€‚
>> è‹¥ä¸å¯ç”¨ï¼Œå–æ¶ˆå‹¾é€‰å³å¯ã€‚
> 
> ç¬¬äº”æ­¥ï¼šé…ç½®å®Œæ¯•ï¼Œè‡ªè¡Œæµ‹è¯•å¯ç”¨æ€§ã€‚

![img.png](../../pic/rewrite/img.png)![img_2.png](../../pic/rewrite/img_2.png)![img_3.png](../../pic/rewrite/img_3.png)![img_4.png](../../pic/rewrite/img_4.png)

### â‘¡  å†è¯´ `[rewrite_local]`
> ä¸Šé¢çš„é…ç½®æ–‡ä»¶å¦‚æœä½ ä¸æƒ³ç›´æ¥å¼•ç”¨ï¼Œå¯ä»¥å¤åˆ¶å…¶ä¸­çš„å†…å®¹è‡ªè¡Œæ·»åŠ ï¼Œè¿™å°±æ˜¯`[rewrite_local]`

> ç¬¬ä¸€æ­¥ï¼šç‚¹æŒ‰é¦–é¡µå³ä¸‹è§’çš„å°é£è½¦ï¼Œå¾€ä¸‹æ»‘æ‰¾åˆ°`é‡å†™`æ¨¡å—ï¼›é€‰æ‹©`é‡å†™è§„åˆ™`ã€ä¸‹å›¾1ã€‘ï¼›
>
> ç¬¬äºŒæ­¥ï¼šé‡å†™è§„åˆ™é¡µé¢ï¼Œç‚¹å‡»å³ä¸Šè§’åŠ å·è¿›è¡Œå¡«å†™ï¼Œ`ç±»å‹`è¦ä¿æŒä¸€è‡´ï¼Œé€‰æ‹©ä¸Šæ–¹é…ç½®æ–‡ä»¶ä¸­ç¬¬ä¸€è¡Œçš„`script-response-body`ã€ä¸‹å›¾2ï¼Œ3ã€‘ï¼›
>
> ç¬¬ä¸‰æ­¥ï¼š`ç”¨ä»¥åŒ¹é…çš„URL`å’Œ`è„šæœ¬è·¯å¾„`éƒ½æ˜¯ä»ä¸Šæ–¹é…ç½®æ–‡ä»¶ä¸­å¤åˆ¶å‡ºæ¥çš„ï¼Œå¡«å¥½ä»¥åç‚¹å‡»å³ä¸Šè§’å¯¹å·âœ…ä¿å­˜ã€ä¸‹å›¾4ã€‘ï¼›
>
> ç¬¬å››æ­¥ï¼šä¿å­˜ä»¥åæ‰¾åˆ°é‡å†™æ¨¡å—ä¸‹æ–¹çš„`MITM`æ¨¡å—ï¼Œé€‰æ‹©`ä¸»æœºå`ã€ä¸‹å›¾1ã€‘ã€‚
> 
> ç¬¬äº”æ­¥ï¼šä¸»æœºåé¡µé¢ç‚¹å‡»å³ä¸Šè§’åŠ å·ï¼Œå¡«å†™ä¸Šæ–¹é…ç½®æ–‡ä»¶ä¸­çš„hostnameï¼Œç‚¹å‡»`å¥½çš„`ä¿å­˜ï¼›
>> å¼•ç”¨çš„è„šæœ¬å›è‡ªåŠ¨æ›´æ–°ï¼Œè‹¥å‡ºç°404è¡¨ç¤ºèµ„æºä¸å­˜åœ¨ï¼Œç­‰å¾…ä½œè€…æ›´æ–°ï¼›è‹¥æç¤ºèµ„æºæ— æ³•è®¿é—®ã€ç½‘ç»œé”™è¯¯ç­‰å¯æ¢ä¸ªèŠ‚ç‚¹åœ¨å°è¯•æ›´æ–°ã€‚
>>
>> ä½ ä¼šå‘ç°ä¸Šæ–¹é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½ä½¿ç”¨å®Œæ¯•ã€‚
>
> ç¬¬å…­æ­¥ï¼šé…ç½®å®Œæ¯•ï¼Œè‡ªè¡Œæµ‹è¯•å¯ç”¨æ€§ã€‚

![img_5.png](../../pic/rewrite/img_5.png)![img_8.png](../../pic/rewrite/img_8.png)![img_6.png](../../pic/rewrite/img_6.png)![img_7.png](../../pic/rewrite/img_7.png)
![img_9.png](../../pic/rewrite/img_9.png)

### é…ç½®å®Œæ¯•

## 4ï¸âƒ£ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹å¼

